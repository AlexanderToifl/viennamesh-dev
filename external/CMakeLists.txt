IF(VIENNAMESH_WITH_NETGEN)
  set(LOCAL_LIBVIENNAMESH_COMPILE_FLAGS "${LOCAL_LIBVIENNAMESH_COMPILE_FLAGS} -DVIENNAMESH_WITH_NETGEN")
  set(NETGEN_SOURCE_DIR ${EXTERNAL_SOURCE_DIR}/netgen/)

  file(GLOB NETGEN_CSG_SRC "${NETGEN_SOURCE_DIR}/libsrc/csg/*.cpp")
  list(REMOVE_ITEM NETGEN_CSG_SRC "${NETGEN_SOURCE_DIR}/libsrc/csg/csgpkg.cpp")
  list(REMOVE_ITEM NETGEN_CSG_SRC "${NETGEN_SOURCE_DIR}/libsrc/csg/vscsg.cpp")

  file(GLOB NETGEN_GENERAL_SRC "${NETGEN_SOURCE_DIR}/libsrc/general/*.cpp")
  list(REMOVE_ITEM NETGEN_GENERAL_SRC "${NETGEN_SOURCE_DIR}/libsrc/general/gzstream.cpp")

  file(GLOB NETGEN_GEOM2D_SRC "${NETGEN_SOURCE_DIR}/libsrc/geom2d/*.cpp")
  list(REMOVE_ITEM NETGEN_GEOM2D_SRC "${NETGEN_SOURCE_DIR}/libsrc/geom2d/vsgeom2d.cpp")
  list(REMOVE_ITEM NETGEN_GEOM2D_SRC "${NETGEN_SOURCE_DIR}/libsrc/geom2d/geom2dpkg.cpp")

  file(GLOB NETGEN_GPRIM_SRC "${NETGEN_SOURCE_DIR}/libsrc/gprim/*.cpp")

  file(GLOB NETGEN_INTERFACE_SRC "${NETGEN_SOURCE_DIR}/libsrc/interface/*.cpp")

  file(GLOB NETGEN_LINALG_SRC "${NETGEN_SOURCE_DIR}/libsrc/linalg/*.cpp")
  file(GLOB NETGEN_MESHING_SRC "${NETGEN_SOURCE_DIR}/libsrc/meshing/*.cpp")

  file(GLOB NETGEN_STLGEOM_SRC "${NETGEN_SOURCE_DIR}/libsrc/stlgeom/*.cpp")
  list(REMOVE_ITEM NETGEN_STLGEOM_SRC "${NETGEN_SOURCE_DIR}/libsrc/stlgeom/vsstl.cpp")
  list(REMOVE_ITEM NETGEN_STLGEOM_SRC "${NETGEN_SOURCE_DIR}/libsrc/stlgeom/stlpkg.cpp")

  if (VIENNAMESH_NETGEN_WITH_OPENCASCADE)
    find_package(OpenCASCADE REQUIRED)
    include_directories(${OpenCASCADE_INCLUDE_DIR})
    link_directories(${OpenCASCADE_LINK_DIR})

    set(LOCAL_VIENNAMESH_EXTERNAL_INCLUDE_DIRS ${LOCAL_VIENNAMESH_EXTERNAL_INCLUDE_DIRS} ${OpenCASCADE_INCLUDE_DIR})
    set(LOCAL_LIBVIENNAMESH_COMPILE_FLAGS "${LOCAL_LIBVIENNAMESH_COMPILE_FLAGS} -DVIENNAMESH_NETGEN_WITH_OPENCASCADE")

    file(GLOB NETGEN_OCCGEOM_SRC "${NETGEN_SOURCE_DIR}/libsrc/occ/*.cpp" "${NETGEN_SOURCE_DIR}/libsrc/occ/*.cxx")
    list(REMOVE_ITEM NETGEN_OCCGEOM_SRC "${NETGEN_SOURCE_DIR}/libsrc/occ/vsocc.cpp")
    list(REMOVE_ITEM NETGEN_OCCGEOM_SRC "${NETGEN_SOURCE_DIR}/libsrc/occ/occpkg.cpp")
  endif(VIENNAMESH_NETGEN_WITH_OPENCASCADE)



  SET(NETGEN_SRC ${NETGEN_CSG_SRC} ${NETGEN_GENERAL_SRC} ${NETGEN_GEOM2D_SRC} ${NETGEN_GPRIM_SRC} ${NETGEN_INTERFACE_SRC} ${NETGEN_LINALG_SRC} ${NETGEN_MESHING_SRC} ${NETGEN_STLGEOM_SRC} ${NETGEN_OCCGEOM_SRC} ${NETGEN_SOURCE_DIR}/nglib/nglib.cpp)

  SET(NETGEN_COMPILE_FLAGS "${LIBVIENNAMESH_COMPILE_FLAGS} -DPACKAGE_VERSION=5.1")
  if (MSVC)
    SET(NETGEN_COMPILE_FLAGS "${NETGEN_COMPILE_FLAGS} -DMSVC_EXPRESS")
  endif()
  if (VIENNAMESH_NETGEN_WITH_OPENCASCADE)
    SET(NETGEN_COMPILE_FLAGS "${NETGEN_COMPILE_FLAGS} -DOCCGEOMETRY")
  endif(VIENNAMESH_NETGEN_WITH_OPENCASCADE)

#   set(THREADS_REQUIRED_FOR_LIB_VIENNAMESH TRUE PARENT_SCOPE)

  ADD_LIBRARY(viennamesh-netgen ${NETGEN_SRC})
  SET_PROPERTY(TARGET viennamesh-netgen APPEND PROPERTY INCLUDE_DIRECTORIES ${NETGEN_SOURCE_DIR}/libsrc/include)
  SET_PROPERTY(TARGET viennamesh-netgen APPEND_STRING PROPERTY COMPILE_FLAGS "${NETGEN_COMPILE_FLAGS}")

  SET(LOCAL_VIENNAMESH_EXTERNAL_INCLUDE_DIRS ${LOCAL_VIENNAMESH_EXTERNAL_INCLUDE_DIRS} ${NETGEN_SOURCE_DIR}/libsrc/include)
  SET(LOCAL_VIENNAMESH_EXTERNAL_LIBRARIES ${LOCAL_VIENNAMESH_EXTERNAL_LIBRARIES} viennamesh-netgen)

  if (VIENNAMESH_NETGEN_WITH_OPENCASCADE)
    target_link_libraries(viennamesh-netgen TKernel TKGeomBase TKMath TKG2d TKG3d TKXSBase TKOffset TKFillet TKShHealing TKMesh TKTopAlgo TKGeomAlgo TKBool TKPrim TKBO TKIGES TKBRep TKSTEPBase TKSTEP TKSTL TKSTEPAttr TKSTEP209 TKXDESTEP TKXDEIGES TKXCAF TKLCAF FWOSPlugin )
  endif(VIENNAMESH_NETGEN_WITH_OPENCASCADE)
endif(VIENNAMESH_WITH_NETGEN)


IF(VIENNAMESH_WITH_TETGEN)
  set(LOCAL_LIBVIENNAMESH_COMPILE_FLAGS "${LOCAL_LIBVIENNAMESH_COMPILE_FLAGS} -DVIENNAMESH_WITH_TETGEN")
  set(TETGEN_SOURCE_DIR ${EXTERNAL_SOURCE_DIR}/tetgen/)

  SET(TETGEN_SRC ${TETGEN_SOURCE_DIR}/tetgen.cxx ${TETGEN_SOURCE_DIR}/predicates.cxx)
  SET(TETGEN_COMPILE_FLAGS "${LIBVIENNAMESH_COMPILE_FLAGS} -DTETLIBRARY")

  ADD_LIBRARY(viennamesh-tetgen ${TETGEN_SRC})
  SET_PROPERTY(TARGET viennamesh-tetgen APPEND_STRING PROPERTY COMPILE_FLAGS "${TETGEN_COMPILE_FLAGS}")
  SET_PROPERTY(TARGET viennamesh-tetgen APPEND PROPERTY INCLUDE_DIRECTORIES ${TETGEN_SOURCE_DIR}/)

  SET(LOCAL_VIENNAMESH_EXTERNAL_INCLUDE_DIRS ${LOCAL_VIENNAMESH_EXTERNAL_INCLUDE_DIRS} ${TETGEN_SOURCE_DIR}/)
  SET(LOCAL_VIENNAMESH_EXTERNAL_LIBRARIES ${LOCAL_VIENNAMESH_EXTERNAL_LIBRARIES} viennamesh-tetgen)
ENDIF(VIENNAMESH_WITH_TETGEN)


IF(VIENNAMESH_WITH_TRIANGLE)
  set(LOCAL_LIBVIENNAMESH_COMPILE_FLAGS "${LOCAL_LIBVIENNAMESH_COMPILE_FLAGS} -DVIENNAMESH_WITH_TRIANGLE")
  set(TRIANGLE_SOURCE_DIR ${EXTERNAL_SOURCE_DIR}/triangle/)

  SET(TRIANGLE_SRC ${TRIANGLE_SOURCE_DIR}/triangle.c ${TRIANGLE_SOURCE_DIR}/triangle_interface.c)
  SET(TRIANGLE_COMPILE_FLAGS "${LIBVIENNAMESH_COMPILE_FLAGS} -DNO_TIMER -DTRILIBRARY -DANSI_DECLARATORS -DEXTERNAL_TEST")

  ADD_LIBRARY(viennamesh-triangle ${TRIANGLE_SRC})
  SET_PROPERTY(TARGET viennamesh-triangle APPEND_STRING PROPERTY COMPILE_FLAGS "${TRIANGLE_COMPILE_FLAGS}")
  SET_PROPERTY(TARGET viennamesh-triangle APPEND PROPERTY INCLUDE_DIRECTORIES ${TRIANGLE_SOURCE_DIR}/)

  SET(LOCAL_VIENNAMESH_EXTERNAL_INCLUDE_DIRS ${LOCAL_VIENNAMESH_EXTERNAL_INCLUDE_DIRS} ${TRIANGLE_SOURCE_DIR}/)
  SET(LOCAL_VIENNAMESH_EXTERNAL_LIBRARIES ${LOCAL_VIENNAMESH_EXTERNAL_LIBRARIES} viennamesh-triangle)
ENDIF(VIENNAMESH_WITH_TRIANGLE)


IF(VIENNAMESH_WITH_VGMODELER)
  set(LOCAL_LIBVIENNAMESH_COMPILE_FLAGS "${LOCAL_LIBVIENNAMESH_COMPILE_FLAGS} -DVIENNAMESH_WITH_VGMODELER")
  set(VGMODELER_SOURCE_DIR ${EXTERNAL_SOURCE_DIR}/vgmodeler/)

#   include_directories( ${VGMODELER_SOURCE_DIR}/gsse/gsse01/gsse )
#   include_directories( ${VGMODELER_SOURCE_DIR}/gsse/gsse02/gsse )

  add_subdirectory(vgmodeler)

#   SET(LOCAL_VIENNAMESH_EXTERNAL_INCLUDE_DIRS ${LOCAL_VIENNAMESH_EXTERNAL_INCLUDE_DIRS} ${VGMODELER_SOURCE_DIR}/gsse/gsse01 ${VGMODELER_SOURCE_DIR}/gsse/gsse01/external/mauch ${VGMODELER_SOURCE_DIR}/gsse/gsse02 ${VGMODELER_SOURCE_DIR}/include ${VGMODELER_SOURCE_DIR} ${VGMODELER_SOURCE_DIR}/gsse/gsse02/external/ )

  SET(LOCAL_VIENNAMESH_EXTERNAL_LIBRARIES ${LOCAL_VIENNAMESH_EXTERNAL_LIBRARIES} viennamesh-vgmodeler)
ENDIF(VIENNAMESH_WITH_VGMODELER)


SET(VIENNAMESH_EXTERNAL_INCLUDE_DIRS ${LOCAL_VIENNAMESH_EXTERNAL_INCLUDE_DIRS} PARENT_SCOPE)
SET(VIENNAMESH_EXTERNAL_LIBRARIES ${LOCAL_VIENNAMESH_EXTERNAL_LIBRARIES} PARENT_SCOPE)
SET(LIBVIENNAMESH_COMPILE_FLAGS "${LIBVIENNAMESH_COMPILE_FLAGS} ${LOCAL_LIBVIENNAMESH_COMPILE_FLAGS}" PARENT_SCOPE)
